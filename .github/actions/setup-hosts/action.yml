name: 'Setup Hosts Mapping'
description: 'Add host mapping to /etc/hosts for APIM instance resolution'
inputs:
  apim_ip:
    description: 'IP address of the APIM instance'
    required: true
  apim_hostname:
    description: 'Hostname of the APIM instance'
    required: true
    default: 'apimgr.lab.demo-latam.axway.com'

runs:
  using: 'composite'
  steps:
    - name: Add host mapping
      shell: bash
      run: |
        echo "üîß Adding host mapping: ${{ inputs.apim_ip }} ${{ inputs.apim_hostname }}"
        echo "${{ inputs.apim_ip }} ${{ inputs.apim_hostname }}" | sudo tee -a /etc/hosts
        echo "‚úÖ Host mapping added successfully"
        
    - name: Verify host resolution
      shell: bash
      run: |
        echo "üîç Verifying host resolution..."
        if ping -c 1 ${{ inputs.apim_hostname }} > /dev/null 2>&1; then
          echo "‚úÖ Host ${{ inputs.apim_hostname }} is reachable"
        else
          echo "‚ö†Ô∏è Host ${{ inputs.apim_hostname }} is not reachable, but mapping was added"
        fi
